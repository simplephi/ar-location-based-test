<html>
  <head>
    <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
    <script src="https://raw.githubusercontent.com/donmccurdy/aframe-extras/master/dist/aframe-extras.loaders.min.js"></script>
    <script>
      AFRAME.registerComponent("foo", {
        init: function() {
          this.el.addEventListener("model-loaded", e => {
            console.log(e);
            let model = this.el.getObject3D("mesh");
            model.traverse(function(node) {
              if (!node.material) return;

              var tmp = node.material
              node.material = new THREE.MeshStandardMaterial({
                skinning: true,
                map: node.material.map
              });
              node.material.needsUpdate = true;
              tmp.dispose()
            });
          });
        }
      });
    </script>
  </head>
  <body>
    <a-scene>
      <a-assets>
        <a-asset-item
          id="glft"
          src="https://raw.githubusercontent.com/simplephi/ar-location-based-test/main/aframe/examples/image-tracking/nft/usdz/torus_gold.gltf"
        ></a-asset-item>
      </a-assets>

      <a-entity light="type: ambient; intensity: 10.2"></a-entity>

      <a-entity
        gltf-model="#glft"
        scale="100 100 100"
        rotation="0 0 0"
        animation="property: rotation; to: 0 360 0; loop: true; dur: 20000"
        position="-2 1 -5"
        foo
      >
      </a-entity>
    <a-text color="black" position="-2.5 0.1 -5" value="overriden material"></a-text>
    <a-entity
        gltf-model="#glft"
        scale="100 100 100"
        rotation="0 0 0"
        animation="property: rotation; to: 0 360 0; loop: true; dur: 20000"
        position="2 1 -5"
      >
      </a-entity>
      <a-text color="black" position="2 0.1 -5" value="original material"></a-text>

      <a-plane
        position="0 0 -4"
        rotation="-90 0 0"
        width="4"
        height="4"
        color="#7BC8A4"
      ></a-plane>
      <a-sky color="#ECECEC"></a-sky>
    </a-scene>
        <!-- include the Glitch button to show what the webpage is about and
          to make it easier for folks to view source and remix -->
    <div class="glitchButton" style="position:fixed;top:20px;right:20px;"></div>
    <script src="https://button.glitch.me/button.js"></script>
  </body>
</html>
